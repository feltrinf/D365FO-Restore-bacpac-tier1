{"tasks":[{"environment":{},"displayName":"Get-LCSApiToken","alwaysRun":false,"continueOnError":false,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"inputs":{"targetType":"inline","filePath":"","arguments":"","script":"#https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/database/api/dbmovement-api-authentication\n   \n   $tokenBody = @{\n       grant_type = \"password\"\n       client_id = \"$(clientId)\"\n       client_secret = \"$(clientSecret)\"\n       resource = \"$(LcsApiUri)\"\n       username = \"$(username)\"\n       password = \"$(password)\"\n   }\n    \n   try\n   {\n       $res = Invoke-RestMethod -Method Post -Uri $(tokenUri) -Body $tokenBody\n   \n       $access_token=$res.access_token\n       $refresh_token=$res.refresh_token\n       $expires_in=$res.expires_in\n   \n       #https://github.com/Microsoft/azure-pipelines-agent/blob/master/docs/preview/outputvariable.md\n       Write-Host \"##vso[task.setvariable variable=access_token]$access_token\"\n       Write-Host \"##vso[task.setvariable variable=refresh_token]$refresh_token\"\n       Write-Host \"##vso[task.setvariable variable=expires_in]$expires_in\"\n   }\n   catch\n   {\n       Write-Host \"Failed to trigger request {$TOKENURI}, Exception: $_\" -ForegroundColor Red\n   }\n\nreturn $access_token\n","errorActionPreference":"stop","failOnStderr":"false","ignoreLASTEXITCODE":"false","pwsh":"false","workingDirectory":""},"task":{"id":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","versionSpec":"2.*","definitionType":"task"}}],"runsOn":["Agent","DeploymentGroup"],"revision":7,"createdBy":{"displayName":"Francesco Feltrin","id":"6671c05e-8b0e-6a74-9e5d-a2c2dc2afa6e","uniqueName":"francesco.feltrin@cegeka.it"},"createdOn":"2020-05-09T14:49:22.980Z","modifiedBy":{"displayName":"Francesco Feltrin","id":"6671c05e-8b0e-6a74-9e5d-a2c2dc2afa6e","uniqueName":"francesco.feltrin@cegeka.it"},"modifiedOn":"2020-05-10T12:41:41.347Z","comment":"","id":"de4d7216-34dd-4ac0-9960-7ea556312976","name":"cgkGet-LcsApiToken","version":{"major":1,"minor":0,"patch":0,"isTest":false},"iconUrl":"https://cdn.vsassets.io/v/M168_20200506.1/_content/icon-meta-task.png","friendlyName":"cgkGet-LcsApiToken","description":"Get LCS API access token","category":"Utility","definitionType":"metaTask","author":"Francesco Feltrin","demands":[],"groups":[],"inputs":[{"aliases":[],"options":{},"properties":{},"name":"clientId","label":"clientId","defaultValue":"$(clientId)","required":true,"type":"string","helpMarkDown":"","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"clientSecret","label":"clientSecret","defaultValue":"$(clientSecret)","required":true,"type":"string","helpMarkDown":"","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"LcsApiUri","label":"LcsApiUri","defaultValue":"$(LcsApiUri)","required":true,"type":"string","helpMarkDown":"https://lcsapi.lcs.dynamics.com","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"password","label":"password","defaultValue":"$(password)","required":true,"type":"string","helpMarkDown":"","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"tokenUri","label":"tokenUri","defaultValue":"$(tokenUri)","required":true,"type":"string","helpMarkDown":"https://login.microsoftonline.com/common/oauth2/token","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"username","label":"username","defaultValue":"$(username)","required":true,"type":"string","helpMarkDown":"","groupName":""}],"satisfies":[],"sourceDefinitions":[],"dataSourceBindings":[],"instanceNameFormat":"Task group: cgkGet-LcsApiToken $(clientId)","preJobExecution":{},"execution":{},"postJobExecution":{}}