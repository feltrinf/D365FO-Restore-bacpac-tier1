{"tasks":[{"environment":{},"displayName":"Update WIT Status","alwaysRun":false,"continueOnError":false,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"inputs":{"targetType":"inline","filePath":"","arguments":"","script":"$uri= ('{0}{1}/_apis/build/builds/{2}/workitems?api-version=5.1' -f $($env:SYSTEM_TEAMFOUNDATIONSERVERURI), $($env:SYSTEM_TEAMPROJECTID), $($env:BUILD_BUILDID))\n\nWrite-Host \"uri: $uri\"\n\nTry\n{\n    $response = Invoke-RestMethod -Method Get -ContentType \"application/json\" -Uri $uri -Headers @{Authorization = \"Bearer $env:SYSTEM_ACCESSTOKEN\" } -Verbose -Debug\n\n    Write-Host \"Build Work Items Refs: $response\" \n\n$jsonRequestBody=@\"\n[   \n    {\n    \"op\": \"replace\",\n    \"path\": \"/fields/System.State\",\n    \"value\": \"$(WITStatus)\"\n    }\n]\n\"@\n\n    if($response.count -gt 0)\n    {\n        $values=$response.value \n\n        foreach($value in $values)\n        {\n            $id=$value.id\n            $uri=('{0}{1}/_apis/wit/workitems/{2}?api-version=5.1' -f $($env:SYSTEM_TEAMFOUNDATIONSERVERURI), $($env:SYSTEM_TEAMPROJECTID), $id)        \n\n            Write-Host \"patch uri: $uri\"\n\n            $response = Invoke-RestMethod -Method PATCH -ContentType \"application/json-patch+json\" -Uri $uri -Body $jsonRequestBody -Headers @{Authorization = \"Bearer $env:SYSTEM_ACCESSTOKEN\" } -Verbose -Debug\n        }\n    }\n\n}\ncatch \n{\n    Write-Host \"Failed to trigger request {$uri}, Exception: $_\" -ForegroundColor Red\n}","errorActionPreference":"stop","failOnStderr":"false","ignoreLASTEXITCODE":"false","pwsh":"false","workingDirectory":""},"task":{"id":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","versionSpec":"2.*","definitionType":"task"}}],"runsOn":["Agent","DeploymentGroup"],"revision":14,"createdBy":{"displayName":"Francesco Feltrin","id":"6671c05e-8b0e-6a74-9e5d-a2c2dc2afa6e","uniqueName":"francesco.feltrin@cegeka.it"},"createdOn":"2020-05-12T09:03:54.277Z","modifiedBy":{"displayName":"Francesco Feltrin","id":"6671c05e-8b0e-6a74-9e5d-a2c2dc2afa6e","uniqueName":"francesco.feltrin@cegeka.it"},"modifiedOn":"2020-05-12T14:23:47.553Z","comment":"","id":"421c710b-da5e-4a3b-9048-599f37b6f7eb","name":"cgkUpdateWITStatusInBuild","version":{"major":1,"minor":0,"patch":0,"isTest":false},"iconUrl":"https://cdn.vsassets.io/v/M168_20200508.1/_content/icon-meta-task.png","friendlyName":"cgkUpdateWITStatusInBuild","description":"Update the state of work items that are linked to build pipelines","category":"Utility","definitionType":"metaTask","author":"Francesco Feltrin","demands":[],"groups":[],"inputs":[{"aliases":[],"options":{},"properties":{},"name":"$env:BUILD_BUILDID","label":"$env:BUILD_BUILDID","defaultValue":"$($env:BUILD_BUILDID)","required":true,"type":"string","helpMarkDown":"","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"$env:SYSTEM_TEAMFOUNDATIONSERVERURI","label":"$env:SYSTEM_TEAMFOUNDATIONSERVERURI","defaultValue":"$($env:SYSTEM_TEAMFOUNDATIONSERVERURI)","required":true,"type":"string","helpMarkDown":"","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"$env:SYSTEM_TEAMPROJECTID","label":"$env:SYSTEM_TEAMPROJECTID","defaultValue":"$($env:SYSTEM_TEAMPROJECTID)","required":true,"type":"string","helpMarkDown":"","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"WITStatus","label":"WITStatus","defaultValue":"$(WITStatus)","required":true,"type":"string","helpMarkDown":"","groupName":""}],"satisfies":[],"sourceDefinitions":[],"dataSourceBindings":[],"instanceNameFormat":"Task group: cgkUpdateWITStatusInBuild $($env:BUILD_BUILDID)","preJobExecution":{},"execution":{},"postJobExecution":{}}